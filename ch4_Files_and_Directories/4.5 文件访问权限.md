# 文件访问权限

`st_mode`值包含了针对文件访问权限位，任何文件都有访问权限。

st\_mode | meaning
--- | ---
S_IRUSR | user-read
S_IWUSR | user-write
S_IXUSR | user-execute
S_IRGRP | group-read
S_IWGRP | group-write
S_IXGRP | group-execute
S_IROTH | other-read
S_IWOTH | other-write
S_IXOTH | other-execute

* 当使用名字打开一个文件时，对该名字中包含的每一个目录，包括它可能隐含的当前工作目录都应具有执行权限。这就是为什么目录执行权限位被称为搜索位的原因。读权限允许读取目录，获得在该目录中的文件名的列表。当一个目录是要访问文件的路径名的一个组成部分时，对该目录的执行权限使得可以通过该目录。
* 对于一个文件的读权限决定了能否打开该文件进行读操作。与open函数的`O_RDONLY`和`O_RDWR`相关。
* 对于一个文件的写权限决定了能否打开该文件进行写操作。与open函数的`O_WRONLY`和`O_RDWR`相关。
* 为了在open函数中对一个文件指定`O_TRUNC`标志，必须对该文件具有写权限。
* 为了在一个目录中创建一个新文件，必须对该目录有写权限和执行权限。
* 为了删除一个现有的文件，必须对包含该文件的目录具有写权限和执行权限。
* 如果用6个exec函数中的任何一个执行某个文件，都必须对该文件具有执行权限。该文件还必须是一个普通文件。

进程每次打开、创建或者删除一个文件时，内核就进行文件访问权限测试，测试过程如下：

* 若进程的有效用户ID是0，则允许访问。这给予了超级用户对整个文件系统进行处理的最充分的自由。
* 若进程的有效用户ID等于文件的所有者ID，那么：若所有者适当的访问权限位被设置，则允许访问，否则拒绝访问。适当的访问权限位指的是，若进程为读而打开文件，则用户读位应为1；若进程为写而打开该文件，则用户写位应为1；若进程将执行该文件，则用户执行位应为1。
* 若进程的有效组ID或者进程的附加组ID之一等于文件的组ID，那么：若组适当的访问权限位被设置，则允许访问，否则拒绝访问。
* 若其他用户适当的访问权限位被设置，则允许访问否则拒绝访问。



