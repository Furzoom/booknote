# 函数futimens、utimensat和utimes

对一个文件的访问和修改时间的更改可以使用下面的函数。

```c
#include <sys/stat.h>
// Change file timestamps with nanosecond precision
int futimens(int fd, const struct timespec times[2]);
int utimensat(int fd, const char *pathname, const struct timespce times[2], int flag);
```
* 成功返回0，失败返回-1。
* times数组的第一个元素包含访问时间，第二个元素包含修改时间。时间为日历时间。
 * 如果times参数是一个空指针，则访问时间和修改时间都设置为当前时间。
 * 如果times指向两个timespec结构，任一元素的`tv_nsec`字段的值为`UTIME_NOW`，相应的时间戳设置为当前时间，忽略相应的`tv_sec`字段。
 * 如果times指向两个timespec结构，任一元素的`tv_nsec`字段的值为`UTIME_OMIT`，相应的时间戳保持不变，忽略相应的`tv_sec`字段。
 * 如果times指向两个timespec结构的数组，且`tv_nsec`字段的值即不是`UTIME_NOW`和`UTIME_OMIT`，则相应的时间戳设置为相应的`tv_sec`和`tv_nsec`的值。

权限要求：
* 如果times是一个空指针，或者任一`tv_nsec`字段设为`UTIME_NOW`，则进程的有效用户ID必须等于该文件的所有者ID；进程对该文件必须具有写权限，或者进程是一个超级用户进程。
* 如果times是一个非空指针，并且任一`tv_nsec`字段既不是`UTIME_NOW`也不是`UTIME_OMIT`，则进程的有效用户ID必须等于该文件的所有者ID，或者进程必须是一个超级用户进程。对文件只具有写权限是不够的。
* 如果times是非空指针，并且两个`tv_nsec`字段的值都为`UTIME_OMIT`，就不执行任何的权限检查。

futimens函数需要打开文件来更改它的时间，utimensat函数使用文件名来更改时间。pathname是相对于fd参数进行计算的。fd要么是打开目录的文件描述符，要么是特殊值`AT_FDCWD`，如果pathname指定的绝对路径，那么fd参数被忽略。

flag如果设置为`AT_SYMLINK_NOFOLLOW`标志，则符号链接本身的时间会被更改。否则跟随符号链接，修改被链接文件的时间。

```c
#include <sys/time.h>
// Change file last access and modification times
int utimes(const char *pathname, const struct timeval times[2]);

struct timeval{
  time_t tv_sec; // second
  long tv_usec;  // microseconds
}
```

* 成功返回0，出错返回-1。
