# 函数chown、fchown、fchownat和lchown

这几个函数用于改变文件的用户ID和组ID。如果参数owner和group其一为`-1`，则对应的ID不变：

```c
#include <unistd.h>
int chown(const char *pathname, uid_t owner, gid_t group);
int fchown(int fd, uid_t owner, gid_t group);
int fchownat(int fd, const char *pathname, uid_t owner, gid_t group, int flag);
int lchown(const char *pathname, uid_t owner, gid_t group);
```

* 成功返回0，出错返回-1。

除了所引用的文件是符号链接外，这4个函数的操作类似。在符号链接情况下，lchown和fchownat(设置了`AT_SYMLINK_NOFOLLOW`标志)更改符号链接本身，而不是链接所指向的文件。

fchown函数改变fd参数所指向的打开文件的所有者。由于已经打开，不能改变符号链接本身的所有者。

fchownat函数与chown或者lchown函数在如下情况下是相同的：pathname是绝对路径，或者fd参数取值为`AT_FDCWD`而pathname参数为相对路径。如果参数flag设置了`AT_SYMLINK_NOFOLLOW`标志，fchownat与lchown行为相同。如果flag清除了`AT_SYMLINK_NOFOLLOW`标志，则与chown行为相同。如果fd设置为打开文件描述符，并且pathname为相对路径，则fchownat计算相对于打开目录的pathname。

基于BSD的系统一直规定只有超级用户才能更改一个文件的所有者。而System V则规定任一用户更改它们自己所拥有的文件的所有者。

若`_POSIX_CHOWN_RESTRICTED`对指定的文件生效，则：

* 只有超级用户进程能更改该文件的用户ID。
* 如果进程拥有此文件(其有效用户ID等于该文件的用户ID)，参数owner等于-1或文件的用户ID，并且参数group等于进程的有效组ID或者进程的附属组ID之一，那么一个非超级用户进可以更改该文件的组ID。

这意味着，不能更改其他用户文件的用户ID。可以更改自己所拥有的文件的组ID，但也只限于改到自己所属的组。

如果这些函数由非超级用户进程调用，在成功返回时，文件的设置用户ID和设置组ID位都被清除。