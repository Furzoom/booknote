# 函数stat、fstat、fstatat和lstat


```c
#include <sys/stat.h>

int stat(const char *restrict pathname, struct stat *restrict buf);
int fstat(int fd, struct stat *buf);
int lstat(const char *restrict pathname, struct stat *restrict buf);
int fstatat(int fd, const char *restrict pathname, struct stat *restrict buf, int flag);
```

* 若成功返回0，出错返回-1。

stat返回与命名文件有关的信息结构。fstat函数获得已在描述符fd上打开文件的有关信息。lstat函数类似于stat，但是当命名的文件是一个符号链接时，返回该符号链接的有关信息。

fstatat函数获得相对于当前打开目录(由fd参数指向)的路径名返回文件统计信息。如果参数flag设置为`AT_SYMLINK_NOFOLLOW`时，返回符号链接本身的信息，没有设置则返回符号链接指向文件的信息。如果fd为`AT_FDCWD`，并且pathname是一个相对路径名，返回相对于当前目录的pathname参数。如果pathname是一个绝对路径，fd参数就会被忽略。此时根据flag取得，fstatat与stat或lstat相同。

第二个参数buf是一个指针，函数会填充指向的结构，其定义如下：

```c
struct stat {
	mode_t		st_mode;	// file type & mode (permissions)
	ino_t		st_ino;		// i-node number (serial number)
	dev_t		st_dev;		// device number (file system)
	dev_t		st_rdev;	// device number for special files
	nlink_t		st_nlink;	// number of links
	uid_t		st_uid;		// user ID of owner
	gid_t		st_gid;		// group id of owner
	off_t		st_size;	// size in bytes, for regular files
	struct timespec	st_atime;	// time of last access
	struct timespec	st_mtime;	// time of last modification
	struct timespec st_ctime;	// time of last file status change
	blksize_t	st_blksize;	// best I/O block size
	blkcnt_t	st_blocks;	// number of disk blocks allocated
};

struct timespce {
	time_t	tv_sec;
	long	tv_nsec;
};
```
